from matplotlib import pyplot
import visualkeras
from PIL import ImageFont


# plotting diagnostic learning curves
def summarize_diagnostics(history):
    # Plotting loss
    pyplot.figure()
    pyplot.plot(history.history["loss"], color="blue", label="train")
    pyplot.plot(history.history["val_loss"], color="orange", label="validation")
    pyplot.title("Model Loss")
    pyplot.ylabel("Loss")
    pyplot.xlabel("Epoch")
    pyplot.legend(["Train", "Validation"], loc="upper right")
    pyplot.savefig(r"D:\Repos\mw-detection-using-image\images\loss_plot.png")
    pyplot.close()

    # Plotting accuracy
    pyplot.figure()
    pyplot.plot(history.history["accuracy"], color="blue", label="train")
    pyplot.plot(history.history["val_accuracy"], color="orange", label="validation")
    pyplot.title("Model Accuracy")
    pyplot.ylabel("Accuracy")
    pyplot.xlabel("Epoch")
    pyplot.legend(["Train", "Validation"], loc="upper left")
    pyplot.savefig(r"D:\Repos\mw-detection-using-image\images\accuracy_plot.png")
    pyplot.close()


def plot_dataset(sizes):
    labels = "Train", "Validation", "Test"
    explode = (0, 0, 0.1)  # only "explode" the 3rd slice (Test)

    # Create a new figure, which is not strictly necessary, but good practice.
    pyplot.figure()

    # Plot pie chart
    pyplot.pie(
        sizes,
        explode=explode,
        labels=labels,
        autopct="%1.1f%%",
        shadow=True,
        startangle=90,
    )

    # Save the figure before showing it
    pyplot.savefig(r"D:\Repos\mw-detection-using-image\images\dataset_pie.png")

    # Show the plot
    pyplot.show()


def visualize_model(model):
    try:
        # Load the font (may need to adjust path based on your system)
        font = ImageFont.truetype("arial.ttf", 32)
    except IOError:
        # In case the specific font is not found, fall back to a default one
        font = ImageFont.load_default()

    try:
        # Generate the visualization
        visualkeras.layered_view(
            model,
            legend=True,
            font=font,
            to_file=r"D:\Repos\mw-detection-using-image\images\model_visual.png",
        ).show()
    except Exception as e:
        print(f"An error occurred while visualizing the model: {e}")
